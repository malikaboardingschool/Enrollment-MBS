<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulir PSB Online - Malika Islamic Boarding School</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .form-section {
            border-left: 3px solid #10B981; /* a nice green color */
            padding-left: 1.5rem;
            margin-bottom: 2rem;
        }
        /* Custom spinner */
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4 sm:p-6 lg:p-8">

    <div class="w-full max-w-3xl bg-white rounded-xl shadow-lg p-6 sm:p-8 lg:p-10">
        <!-- Header -->
        <div class="text-center mb-8">
            <img src="https://placehold.co/100x100/10B981/FFFFFF?text=MIS" alt="Logo Malika Islamic School" class="mx-auto mb-4 rounded-full">
            <h1 class="text-2xl sm:text-3xl font-bold text-gray-800">Formulir PPDB Online</h1>
            <h2 class="text-lg sm:text-xl font-semibold text-emerald-600">Malika Islamic Boarding School</h2>
            <p class="text-gray-500 mt-2">Tahun Ajaran 2026/2027</p>
        </div>

        <form id="ppdbForm">
            <!-- Data Diri Calon Siswa -->
            <div class="form-section">
                <h3 class="text-xl font-bold text-gray-700 mb-6">A. Data Diri Calon Siswa</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="nama_lengkap" class="block text-sm font-medium text-gray-700 mb-1">Nama Lengkap</label>
                        <input type="text" id="nama_lengkap" name="Nama Lengkap" class="w-full p-3 border border-gray-300 rounded-md focus:ring-emerald-500 focus:border-emerald-500" required>
                    </div>
                    <div>
                        <label for="jenis_kelamin" class="block text-sm font-medium text-gray-700 mb-1">Jenis Kelamin</label>
                        <select id="jenis_kelamin" name="Jenis Kelamin" class="w-full p-3 border border-gray-300 rounded-md focus:ring-emerald-500 focus:border-emerald-500" required>
                            <option value="">Pilih Jenis Kelamin</option>
                            <option value="Laki-laki">Laki-laki</option>
                            <option value="Perempuan">Perempuan</option>
                        </select>
                    </div>
                    <div>
                        <label for="tempat_lahir" class="block text-sm font-medium text-gray-700 mb-1">Tempat Lahir</label>
                        <input type="text" id="tempat_lahir" name="Tempat Lahir" class="w-full p-3 border border-gray-300 rounded-md focus:ring-emerald-500 focus:border-emerald-500" required>
                    </div>
                    <div>
                        <label for="tanggal_lahir" class="block text-sm font-medium text-gray-700 mb-1">Tanggal Lahir</label>
                        <input type="date" id="tanggal_lahir" name="Tanggal Lahir" class="w-full p-3 border border-gray-300 rounded-md focus:ring-emerald-500 focus:border-emerald-500" required>
                    </div>
                     <div>
                        <label for="asal_sekolah" class="block text-sm font-medium text-gray-700 mb-1">Asal Sekolah (TK/PAUD)</label>
                        <input type="text" id="asal_sekolah" name="Asal Sekolah" class="w-full p-3 border border-gray-300 rounded-md focus:ring-emerald-500 focus:border-emerald-500" placeholder="Opsional">
                    </div>
                </div>
            </div>

            <!-- Data Orang Tua/Wali -->
            <div class="form-section">
                <h3 class="text-xl font-bold text-gray-700 mb-6">B. Data Orang Tua / Wali</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="nama_ayah" class="block text-sm font-medium text-gray-700 mb-1">Nama Ayah</label>
                        <input type="text" id="nama_ayah" name="Nama Ayah" class="w-full p-3 border border-gray-300 rounded-md focus:ring-emerald-500 focus:border-emerald-500" required>
                    </div>
                    <div>
                        <label for="nama_ibu" class="block text-sm font-medium text-gray-700 mb-1">Nama Ibu</label>
                        <input type="text" id="nama_ibu" name="Nama Ibu" class="w-full p-3 border border-gray-300 rounded-md focus:ring-emerald-500 focus:border-emerald-500" required>
                    </div>
                    <div>
                        <label for="no_wa" class="block text-sm font-medium text-gray-700 mb-1">Nomor Telepon / WA Aktif</label>
                        <input type="tel" id="no_wa" name="Nomor WA" class="w-full p-3 border border-gray-300 rounded-md focus:ring-emerald-500 focus:border-emerald-500" required placeholder="Contoh: 08123456789">
                    </div>
                     <div class="md:col-span-2">
                        <label for="alamat" class="block text-sm font-medium text-gray-700 mb-1">Alamat Lengkap</label>
                        <textarea id="alamat" name="Alamat" rows="3" class="w-full p-3 border border-gray-300 rounded-md focus:ring-emerald-500 focus:border-emerald-500" required></textarea>
                    </div>
                </div>
            </div>
            
            <!-- Jalur Pendaftaran dan Pembayaran -->
            <div class="form-section">
                 <h3 class="text-xl font-bold text-gray-700 mb-6">C. Pendaftaran & Pembayaran</h3>
                 <div>
                    <label for="jalur_pendaftaran" class="block text-sm font-medium text-gray-700 mb-2">Pilih Jalur Pendaftaran</label>
                    <select id="jalur_pendaftaran" name="Jalur Pendaftaran" class="w-full p-3 border border-gray-300 rounded-md focus:ring-emerald-500 focus:border-emerald-500" required>
                        <option value="">-- Pilih salah satu --</option>
                        <option value="Reguler">Reguler (Membayar Biaya Formulir)</option>
                        <option value="Beasiswa">Beasiswa (Gratis Biaya Formulir)</option>
                    </select>
                </div>

                <!-- Bagian ini akan muncul otomatis -->
                <div id="paymentInfo" class="hidden mt-6 bg-emerald-50 border-l-4 border-emerald-500 text-emerald-800 p-4 rounded-md">
                    <h4 class="font-bold text-lg mb-2">Instruksi Pembayaran</h4>
                    <p class="mb-4">Silakan lakukan pembayaran biaya pendaftaran sebesar <strong>Rp 250.000,-</strong> ke nomor rekening berikut:</p>
                    <div class="bg-white p-4 rounded-lg border border-gray-200">
                        <p class="text-sm">Bank Tujuan:</p>
                        <p class="font-bold text-xl">Bank Danamon</p>
                        <p class="text-sm mt-2">Nomor Rekening:</p>
                        <div class="flex items-center justify-between mt-1">
                            <p id="accountNumber" class="font-bold text-2xl tracking-wider">8800323233</p>
                            <button type="button" onclick="copyToClipboard()" class="bg-gray-200 hover:bg-gray-300 text-gray-700 text-xs font-bold py-1 px-3 rounded">
                                SALIN
                            </button>
                        </div>
                         <p class="text-sm mt-2">Atas Nama:</p>
                        <p class="font-bold text-xl">Malika Islamic School</p>
                    </div>
                    <p class="text-xs mt-4">Penting: Mohon simpan bukti transfer Anda. Data Anda akan kami proses setelah pembayaran terverifikasi.</p>
                
                    <div class="mt-4">
                        <label for="bukti_transfer" class="block text-sm font-medium text-gray-900 mb-2">Upload Bukti Transfer</label>
                        <input type="file" id="bukti_transfer" name="Bukti Transfer" class="w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-emerald-100 file:text-emerald-700 hover:file:bg-emerald-200 cursor-pointer" accept="image/png, image/jpeg, image/jpg">
                        <p class="text-xs text-gray-500 mt-1">Hanya file JPG, JPEG, atau PNG.</p>
                    </div>
                </div>
            </div>

            <!-- Tombol Submit -->
            <div class="mt-10 flex flex-col items-center">
                 <button type="submit" id="submitButton" class="w-full md:w-1/2 bg-emerald-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-emerald-500 transition-all duration-300">
                    Kirim Formulir
                </button>
                <div id="loader" class="loader hidden my-4"></div>
                <div id="statusMessage" class="mt-4 text-center"></div>
            </div>
        </form>
    </div>

    <script>
        const scriptURL = 'MASUKKAN_URL_GOOGLE_APPS_SCRIPT_ANDA_DI_SINI'; // PENTING: Ganti dengan URL Anda!
        const form = document.getElementById('ppdbForm');
        const jalurPendaftaranSelect = document.getElementById('jalur_pendaftaran');
        const paymentInfoDiv = document.getElementById('paymentInfo');
        const buktiTransferInput = document.getElementById('bukti_transfer');
        const submitButton = document.getElementById('submitButton');
        const loader = document.getElementById('loader');
        const statusMessage = document.getElementById('statusMessage');

        // Fungsi untuk menampilkan/menyembunyikan info pembayaran
        jalurPendaftaranSelect.addEventListener('change', function() {
            if (this.value === 'Reguler') {
                paymentInfoDiv.classList.remove('hidden');
                buktiTransferInput.required = true;
            } else {
                paymentInfoDiv.classList.add('hidden');
                buktiTransferInput.required = false;
                buktiTransferInput.value = ''; // Hapus file jika jalur diubah
            }
        });
        
        // Fungsi untuk menyalin nomor rekening
        function copyToClipboard() {
            const accountNumber = document.getElementById('accountNumber').innerText;
            navigator.clipboard.writeText(accountNumber).then(() => {
                alert('Nomor rekening berhasil disalin!');
            }).catch(err => {
                console.error('Gagal menyalin teks: ', err);
                alert('Gagal menyalin. Mohon salin secara manual.');
            });
        }

        // Fungsi untuk menangani pengiriman formulir
        form.addEventListener('submit', e => {
            e.preventDefault();

            submitButton.classList.add('hidden');
            loader.classList.remove('hidden');
            statusMessage.textContent = '';

            const file = buktiTransferInput.files[0];
            
            // Jika jalur reguler dan ada file, baca sebagai base64
            if (jalurPendaftaranSelect.value === 'Reguler' && file) {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => {
                    const fileData = {
                        base64: reader.result.split(',')[1],
                        type: file.type,
                        name: file.name
                    };
                    sendData(fileData);
                };
                reader.onerror = (error) => {
                    console.error('Error reading file:', error);
                    handleFormError('Gagal membaca file bukti transfer.');
                };
            } else {
                // Kirim data tanpa file
                sendData(null);
            }
        });

        function sendData(fileData) {
            const formData = new FormData(form);
            const data = {};
            formData.forEach((value, key) => {
                data[key] = value;
            });
            
            // Hapus field file default, kita akan kirim data file terpisah
            delete data['Bukti Transfer']; 

            const payload = {
                formData: data,
                fileData: fileData
            };
            
            fetch(scriptURL, { 
                method: 'POST', 
                body: JSON.stringify(payload),
                headers: {
                    'Content-Type': 'text/plain;charset=utf-8', // Apps Script needs text/plain for this method
                },
             })
            .then(response => response.json())
            .then(res => {
                if (res.result === "success") {
                    handleFormSuccess();
                } else {
                    console.error('Error from server!', res.error);
                    handleFormError(res.error || 'Terjadi kesalahan di server.');
                }
            })
            .catch(error => {
                console.error('Error!', error.message);
                handleFormError('Gagal mengirim formulir. Periksa koneksi Anda.');
            });
        }
        
        function handleFormSuccess() {
            loader.classList.add('hidden');
            submitButton.classList.remove('hidden');
            statusMessage.textContent = 'Formulir berhasil terkirim! Terima kasih telah mendaftar.';
            statusMessage.className = 'mt-4 text-center text-green-600 font-semibold';
            
            setTimeout(() => {
                form.reset();
                paymentInfoDiv.classList.add('hidden');
                buktiTransferInput.required = false;
                statusMessage.textContent = '';
            }, 3000);
        }

        function handleFormError(message) {
            loader.classList.add('hidden');
            submitButton.classList.remove('hidden');
            statusMessage.textContent = message || 'Terjadi kesalahan. Mohon coba lagi.';
            statusMessage.className = 'mt-4 text-center text-red-600 font-semibold';
        }

    </script>
</body>
</html>


